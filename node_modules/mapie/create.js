

const simpleGit = require('simple-git');
const git = simpleGit({
    baseDir: process.cwd()
});
const fs = require('fs');
const ejs = require('ejs');

const mxpConfig = projectName => {
    return `{
    "app": "${projectName}",
    "ignoreFiles": []
}`;
} 

const { exec } = require("child_process");

const remote = "https://github.com/nidhil931/mxp-init.git"

module.exports = ([projectName]) => {
    if(projectName) {
        git.clone(remote, projectName).then(()=>{
            fs.rmdirSync(process.cwd()+'/'+projectName+'/.git', { recursive: true });
            fs.writeFile(process.cwd()+'/'+projectName+'/pie.json', mxpConfig(projectName), err=>{
                if(err) {
                    console.log("Error while updating config");
                }
                
                console.log(`Mapie project ${projectName} created. Enter into project directory and run 'pie run'`);
            })
            //  exec npm install
            // exec(`npm install --prefix ./${projectName}`, (error, stdout, stderr) => {
            //     if (error) {
            //         console.log(`error: ${error.message}`);
            //         return;
            //     }
            //     if (stderr) {
            //         console.log(`stderr: ${stderr}`);
            //         return;
            //     }
            //     console.log(stdout);
            // })
        })
        .catch(err=>{console.log(err.message )})
    }else{
        console.log('Project name not provided');
    }   
}