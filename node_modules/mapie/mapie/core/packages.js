const fs = require('fs');
const _ = require('lodash');

module.exports = () => {
    const packages = (() => {

        const fileName = process.cwd()+'/package.json';
        const pkgs = fs.existsSync(fileName) ? (JSON.parse(fs.readFileSync(fileName)).dependencies || {}) : {};
    
        const packages = {};
    
        for (let p in pkgs) {
            packages[_.camelCase(p)] = p;
        }
        return packages;
    })()
    
    if (packages) {
        return new Proxy(packages, {
            get(target, name, receiver) {
                let rv = Reflect.get(target, name, receiver);
                if (typeof rv == 'string') {
                    return require(process.cwd() + '/node_modules/' + rv);
                } else {
                    return null;
                }
            }
        })
    } 
    
    return {};
}

